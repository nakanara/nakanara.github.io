---
title: '[MariaDB] utf8 / utf8mb4'
layout: 
---

![MariaDB](https://mariadb.com/kb/static/images/logo-2018-black.95f5978ae14d.png)

MariaDBì˜ ë¬¸ìì…‹ì„ UTF8ë¡œ ì„¤ì •í•´ë‘ê³  ì‚¬ìš©í•˜ê³  ìˆì—ˆëŠ”ë° SQLì´ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤. ë¡œê·¸ë¥¼ ë´ë„ ê¹¨ì§„ ë¬¸ìì—´ë§Œ ë³´ì´ê³  í•´ë‹¹ ë¬¸ì œê°€ ë¬´ìŠ¨ ê¸€ìì¸ì§€ ëª°ëë‹¤.
ì¸ì½”ë”©ì´ ë§ì§€ ì•Šì•„ì„œ ê¹¨ì§„ ê²ƒì²˜ëŸ¼ ë³´ì´ëŠ” ì¤„ ì•Œì•˜ëŠ”ë° ì•„ë‹ˆì—ˆë‹¤.

ì•Œê³  ë³´ë‹ˆ ì´ëª¨ì§€(ğŸˆğŸ„ğŸƒ)ê°€ ë¬¸ì œì˜€ë‹¤.

UTF-8ì˜ ê²½ìš° 4ë°”ì´íŠ¸ì˜ ì¸ì½”ë”©ì¸ë°, MySQL, MariaDBì˜ ê²½ìš° utf8ì´ 3ë°”ì´íŠ¸ë¡œ êµ¬í˜„ë˜ì–´ ìˆì—ˆë‹¤. ê·¸ ì´í›„ MySQL(5.5.3ë¶€í„°), MariaDBì—ì„œ 4ë°”ì´íŠ¸ ê¸¸ì´ì¸ utf8mb4ê°€ ì¶”ê°€ë˜ì—ˆë‹¤.

ìœ ë‹ˆì½”ë“œ U+10000 ì´ìƒì˜ ë¬¸ìëŠ” UTF-8ë¡œ ì¸ì½”ë”©ì„ í•˜ë ¤ë©´ 4ë°”ì´íŠ¸ê°€ í•„ìš”í•œë°, ìµœê·¼ ë§ì´ ì‚¬ìš©ë˜ê³  ìˆëŠ” ì´ëª¨ì§€ê°€ ê·¸ ìœ í˜•ì´ì—ˆë‹¤.

ì´ëª¨ì§€ëŠ” ìœˆë„ìš°10ì—ì„œ (ìœˆë„ìš°+.ë¡œ ì‚¬ìš© ê°€ëŠ¥)

![image](https://user-images.githubusercontent.com/1871682/103787865-85c1b580-5081-11eb-9605-b5659bdf199c.png)


# utf8mb4 ì„¤ì •

MySQL/MariaDBì—ì„œ utf8mb4ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ my.cnf ì„¤ì • íŒŒì¼ ìˆ˜ì •

```
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqldump]
default-character-set = utf8mb4

[mysqld]
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci
skip-character-set-client-handshake
```

* skip-character-set-client-handshake

DBì„œë²„ì™€ ì ‘ì†ì„ í•  ë•Œ í´ì•„ì´ì–¸íŠ¸ëŠ” ìì‹ ì´ ì‚¬ìš©í•  ë¬¸ìì…‹ ì„¤ì •í•˜ë©°, ê·¸ ì„¤ì •ì„ ì‚¬ìš©í•˜ë„ë¡ ë˜ì–´ìˆì§€ë§Œ **skip-character-set-client-handshake** ì˜µì…˜ì„ ì‚¬ìš©í•  ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„¤ì •í•œ ë¬¸ìì…‹ì„ ë¬´ì‹œí•˜ê³  **character_set_server**ê°’ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.


## ë°ì´í„°ë² ì´ìŠ¤ ë¬¸ìì…‹ ë³€ê²½

```sql
ALTER DATABASE {database} CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;
```

## ê¸°ì¡´ í…Œì´ë¸” ë¬¸ìì…‹ ë³€ê²½

ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ í…Œì´ë¸”ì˜ ë¬¸ìì…‹ì„ ë³€ê²½ì˜ ê²½ìš° **CONVERT TO** ëª…ë ¹ì–´ë¡œ ì§„í–‰í•˜ëŠ” ê²½ìš°ë¡œ í•  ê²½ìš° í•´ë‹¹ í…Œì´ë¸” ë° ì»¬ëŸ¼ì˜ ì†ì„±ê¹Œì§€ í•¨ê»˜ ë³€ê²½

```sql
ALTER TABLE tbl_name
CONVERT TO CHARACTER SET charset_name [COLLATE collation_name];

ALTER TABLE tbl_name 
CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

ì»¬ëŸ¼ì˜ ë¬¸ìì…‹ì˜ ë³€ê²½ì„ í•˜ì§€ ì•Šê³  í…Œì´ë¸”ì— ëŒ€í•œ ë¬¸ìì…‹ ë³€ê²½ë§Œì„ ì§„í–‰í•  ê²½ìš°

```sql
ALTER TABLE tbl_name CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;
```

* ë³€ê²½ ìŠ¤í¬ë¦½íŠ¸ ì¼ê´„ ìƒì„±

```sql
# {database}ëŠ” í•´ë‹¹ ìŠ¤í‚¤ë§ˆ ëª…

SELECT 
    CONCAT('ALTER TABLE `', table_schema, '`.`', TABLE_NAME, '` CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;') AS t
FROM information_schema.TABLES
WHERE table_schema = '{database}'
AND table_type = 'BASE TABLE' # ì—†ëŠ” ê²½ìš° VIEWê¹Œì§€ í¬í•¨ë˜ì–´ ì˜¤ë¥˜ ë°œìƒ
ORDER by table_name;
```

* ìƒì„± ê²°ê³¼
  
```sql
ALTER TABLE `database`.`tbl_name1` 
  CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE `database`.`tbl_name2` 
  CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE `database`.`tbl_name3` 
  CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

## ë¬¸ì œì  ì´ ROW SIZE 65535Byte ì´ˆê³¼
ë¬¸ìì—´ì„ ë³€ê²½ í•˜ëŠ” ê²½ìš° MySQL, MariaDBì˜ ê²½ìš° í•œ ROWì˜ ê¸¸ì´ ì œí•œì´ ì¡´ì¬í•˜ì—¬, 3byte->4byteë¡œ ë³€í™˜ë˜ì–´ ì»¬ëŸ¼ì˜ ë°ì´í„°ë¥¼ ìˆ˜ì • ê°€ëŠ¥ì„± ìˆìŒ varcharì˜ ì¼ë¶€ ê¸¸ì´ë¥¼ ë³€ê²½í•˜ê±°ë‚˜, TEXTë¡œ ë³€í™˜ í•„ìš”

(ì•½ VARCHAR 65,535ë¥¼ í•  ê²½ìš° 16,380ê¸¸ì´ê°€ ê°€ëŠ¥)

![image](https://user-images.githubusercontent.com/1871682/103859941-471e1080-50fe-11eb-9cf8-a1db99520004.png)

## ë¬¸ì œ - INDEXì˜ ê¸¸ì´ê°€ 767byte ì´ˆê³¼í•˜ëŠ” ê²½ìš° ì˜¤ë¥˜

í•˜ë‚˜ì˜ ì»¬ëŸ¼ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆëŠ” INDEXì˜ ìµœëŒ€ ê¸¸ì´ëŠ” 767byteì´ë‹¤.
utf8ì¼ ê²½ìš° ì•½ varchar(255)ì´ë©° (255*3 = 765)ì´ë©°,
utf8mb4ë¡œ ë³€ê²½í•˜ëŠ” ê²½ìš° varchar(191)ê¹Œì§€ ê°€ëŠ¥í•˜ì—¬ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.(191*4 = 764byte)

innodb_large_prefix ì˜µì…˜(ê¸°ë³¸ ê°’)ì„ í™œì„±í™” í•  ê²½ìš° 3,072ë°”ì´íŠ¸ê¹Œì§€ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

> MariaDB 10.3.1 ë¶€í„°ëŠ” ì œê±°ë¨, í™œì„±í™”ê°€ ê¸°ë³¸

## ì°¸ê³ 

* https://medium.com/oldbeedev/mysql-utf8mb4-character-set-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0-da7624958624
  
* https://dev.mysql.com/doc/refman/5.6/en/alter-table.html#alter-table-character-set

* https://mariadb.com/kb/en/innodb-limitations/
* https://dev.mysql.com/doc/refman/8.0/en/innodb-limits.html

#mariadb #mysql #utf8 #utf8mb4 #4byte #emoji 